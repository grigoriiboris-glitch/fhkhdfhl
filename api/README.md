# Go Blog с авторизацией

Простой блог на Go с системой авторизации, использующей библиотеку Casbin для управления доступом.

## Возможности

- ✅ Создание, редактирование и удаление постов
- ✅ Система регистрации и авторизации пользователей
- ✅ Ролевая модель доступа (RBAC) с помощью Casbin
- ✅ JWT токены для аутентификации
- ✅ Хеширование паролей с bcrypt
- ✅ PostgreSQL для хранения данных
- ✅ Docker Compose для развертывания

## Роли и права доступа

### Пользователь (user)
- Чтение постов
- Создание постов
- Редактирование своих постов
- Удаление своих постов

### Автор (author)
- Все права пользователя
- Дополнительные права на управление контентом

### Администратор (admin)
- Все права
- Управление пользователями
- Удаление любых постов

## Установка и запуск

### Требования
- Docker и Docker Compose
- Go 1.22+

### 1. Клонирование репозитория
```bash
git clone <repository-url>
cd go-blog
```

### 2. Настройка переменных окружения
Создайте файл `.env` в корне проекта:
```env
POSTGRES_DB=go_blog
POSTGRES_USER=postgres
POSTGRES_PASSWORD=password
POSTGRES_HOST=localhost:5432
```

### 3. Запуск с Docker Compose
```bash
docker-compose up -d
```

### 4. Применение миграций
```bash
# В контейнере приложения
docker-compose exec app bash
go run main.go
```

### 5. Доступ к приложению
- Веб-интерфейс: http://localhost:8000
- База данных: localhost:5432

## Структура проекта

```
go-blog/
├── auth/                    # Сервис авторизации
│   ├── auth_service.go     # Основная логика авторизации
│   └── middleware.go       # Middleware для проверки прав
├── models/                  # Модели данных
│   ├── post.go            # Модель поста
│   └── user.go            # Модель пользователя
├── repository/             # Слой доступа к данным
│   ├── migrations/         # Миграции базы данных
│   ├── post_repository.go  # Репозиторий постов
│   └── user_repository.go # Репозиторий пользователей
├── templates/              # HTML шаблоны
│   ├── create-post.html   # Форма создания/редактирования поста
│   ├── default.html       # Базовый шаблон
│   ├── index.html         # Главная страница
│   ├── login.html         # Страница входа
│   ├── post.html          # Страница поста
│   └── register.html      # Страница регистрации
├── docker-compose.yml      # Конфигурация Docker Compose
├── Dockerfile             # Docker образ
├── go.mod                 # Зависимости Go
├── handlers.go            # HTTP обработчики
└── main.go               # Главный файл приложения
```

## API Endpoints

### Публичные
- `GET /` - Главная страница со списком постов
- `GET /post/{id}` - Просмотр поста
- `GET /auth/login` - Страница входа
- `GET /auth/register` - Страница регистрации

### Требуют авторизации
- `GET /posts/new` - Форма создания поста
- `POST /posts/new` - Создание поста
- `GET /post/{id}/edit` - Форма редактирования поста
- `POST /post/{id}/edit` - Обновление поста
- `GET /post/{id}/delete` - Удаление поста

### Авторизация
- `POST /auth/login` - Вход в систему
- `POST /auth/register` - Регистрация
- `GET /auth/logout` - Выход из системы

## База данных

### Таблица users
- `id` - Уникальный идентификатор
- `name` - Имя пользователя
- `email` - Email (уникальный)
- `password` - Хешированный пароль
- `role` - Роль пользователя
- `created_at` - Время создания
- `updated_at` - Время обновления

### Таблица posts
- `id` - Уникальный идентификатор
- `title` - Заголовок поста
- `content` - Содержание поста
- `user_id` - ID автора поста
- `created_at` - Время создания
- `updated_at` - Время обновления

## Безопасность

- Пароли хешируются с помощью bcrypt
- JWT токены для аутентификации
- RBAC модель доступа с Casbin
- Проверка прав на уровне middleware
- Защита от CSRF атак

## Разработка

### Добавление новых ролей
1. Обновите политики в `auth_service.go`
2. Добавьте проверки в middleware
3. Обновите UI для отображения новых ролей

### Добавление новых ресурсов
1. Создайте модель в `models/`
2. Добавьте репозиторий в `repository/`
3. Создайте миграции
4. Добавьте политики в Casbin
5. Создайте обработчики и шаблоны

## Лицензия

MIT License
